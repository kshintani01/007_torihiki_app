{% load static %}
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>単票入力 - 分類アプリ POC</title>
<link rel="stylesheet" href="{% static 'myapp/styles.css' %}?v=20250901-1">
</head>
<body>
<header class="app-header">
<h1>単票入力</h1>
<nav><a href="/">← 戻る</a></nav>
</header>


<main class="container">
<form method="post" class="form-card">
{% csrf_token %}

<div class="form-section">
<h3>重要特徴量（SHAP重要度順）</h3>
{% for field in form %}
  {% if field.name != 'threshold' and field.name != 'topk' %}
  <div class="form-row">
    {{ field.label_tag }}
    {{ field }}
    {% if field.errors %}
      <div class="error">{{ field.errors }}</div>
    {% endif %}
  </div>
  {% endif %}
{% endfor %}
</div>

<div class="form-section">
<h3>予測設定</h3>
<div class="form-row">{{ form.threshold.label_tag }} {{ form.threshold }}</div>
<div class="form-row">{{ form.topk.label_tag }} {{ form.topk }}</div>
</div>

<button type="submit" class="btn">予測する</button>
</form>


{% if result %}
<section class="result">
<h2>結果</h2>
<p><strong>予測クラス:</strong> {{ result.pred_class }}</p>
<p><strong>確率:</strong>
{% for k,v in result.proba.items %}
<span class="badge">{{ k }}: {{ v|floatformat:3 }}</span>
{% endfor %}
</p>
<p><strong>判定(しきい値 {{ result.threshold }}):</strong>
{% if result.decision %}<span class="ok">True</span>{% else %}<span class="ng">False</span>{% endif %}
</p>


{% if input_data %}
<details class="details">
<summary>入力データ</summary>
<table class="input-table">
  {% for key, value in input_data.items %}
  <tr><td><strong>{{ key }}</strong></td><td>{{ value }}</td></tr>
  {% endfor %}
</table>
</details>
{% endif %}

{% if features %}
<details class="details">
<summary>前処理後の特徴量</summary>
<pre>{{ features|safe }}</pre>
</details>
{% endif %}
</section>
{% endif %}
</main>
</body>
</html>